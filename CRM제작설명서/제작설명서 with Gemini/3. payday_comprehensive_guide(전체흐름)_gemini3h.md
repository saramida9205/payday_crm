# Payday 프로젝트 제작 총괄 가이드 (Construction Guide)

본 문서는 `payday_planning.md` (기획서)와 `payday_technical_spec.md` (기술설명서)를 기반으로, Payday 대출 관리 시스템을 **처음부터 끝까지 실제로 구현(Development)**하기 위한 실행 가이드입니다. 개발 순서, 핵심 구현 포인트, 그리고 주의사항을 단계별로 상술합니다.

---

## 1. 프로젝트 준비 (Preparation)

### 1.1 환경 구축
1.  **웹 서버 세팅:** Apache 또는 Nginx가 실행되는 서버 준비 (PHP 7.4 이상 권장).
2.  **데이터베이스:** MySQL 5.7+ 또는 MariaDB 설치 및 UTF-8 (utf8mb4) 문자셋 설정.
3.  **프로젝트 폴더:** 웹 루트(예: `/var/www/html` 또는 `htdocs`)에 `payday` 폴더 생성.

### 1.2 필수 라이브러리 및 설정
- **PHP 확장 모듈:** `mysqli`, `curl`, `json`, `mbstring` 필수 활성화.
- **업로드 권한:** `uploads/` 폴더 생성 및 웹 서버 사용자에게 쓰기 권한 부여 (`chmod 775`).

---

## 2. 데이터베이스 구현 (Database Implementation)

### 2.1 테이블 생성 순서 (의존성 고려)
가장 먼저 데이터 구조를 잡아야 합니다. `payday_db_YYYYMMDD.sql`을 참조하되, 다음 순서로 테이블을 생성하십시오.

1.  **기초 정보:** `company_info` (회사 정보), `holidays` (휴일), `users` (관리자 계정).
2.  **핵심 엔티티:** `customers` (고객) -> `contracts` (계약). **주의**: `details` 등 참조 무결성이 필요한 경우 `customers`가 먼저 존재해야 합니다.
3.  **트랜잭션:** `collections` (수납 내역), `contract_expenses` (비용), `condition_changes` (조건 변경).
4.  **로그/스냅샷:** `sms_log`, `bond_ledger_snapshots`.

### 2.2 핵심 스키마 포인트
- **DECIMAL 타입:** 금액과 이자율은 반드시 `DECIMAL` 타입을 사용하십시오 (예: `DECIMAL(15,2)`). `FLOAT`나 `DOUBLE`은 부동소수점 오차가 발생하여 금융산식에 부적합합니다.
- **인덱싱:** `customer_id`, `contract_id`, `collection_date` 컬럼에는 반드시 인덱스를 걸어 조회 속도를 확보해야 합니다.

---

## 3. 백엔드 코어 개발 (Backend Core Development)

### 3.1 공통 모듈 (`common.php`) 구현 - **가장 중요**
모든 페이지에서 사용되는 핵심 함수들을 먼저 완성해야 합니다.

1.  **DB 연결:** `config.php`를 include하여 `mysqli_connect` 수행.
2.  **이자 계산 로직 (`calculateAccruedInterestForPeriod`):**
    - **핵심:** 시작일~종료일 사이의 일수를 구하고, 윤년 여부를 체크하여 `(원금 * 이자율 / 100 / 365 or 366)` 공식 적용.
    - **변동 금리:** `condition_changes` 테이블을 조회하여 기간별로 다른 금리를 적용하는 로직 포함 필수.
3.  **입금 처리 로직 (`process_collection`):**
    - **순서:** 경비 -> 이자 -> 원금 순으로 차감하는 알고리즘 구현.
    - **부족금(Shortfall):** 이자보다 입금액이 적을 경우 발생한 차액을 DB 필드(`shortfall_amount`)에 누적 업데이트.
    - **트랜잭션:** 이 모든 과정은 `mysqli_begin_transaction` ~ `commit` 사이에서 이루어져야 함.

### 3.2 인증 및 세션
- `login.php`와 `process/login_process.php`를 구현하여 세션 기반 로그인을 처리합니다.
- `header.php` 상단에 세션 체크 로직을 넣어, 비로그인 시 로그인 페이지로 리다이렉트되도록 합니다.

---

## 4. 프론트엔드 및 페이지 개발 (Frontend & Page Development)

### 4.1 UI 레이아웃 (`css/style.css`, `header.php`, `sidebar.php`, `footer.php`)
- **반응형:** 데스크탑 기반이나, 모바일에서도 조회가 가능하도록 `@media` 쿼리 적용 (특히 `manual.php` 등).
- **공통 헤더/사이드바:** 메뉴 변경 시 유지보수 편의를 위해 별도 파일로 분리하여 `include` 사용.

### 4.2 주요 기능 페이지 구현 순서
1.  **고객/계약 관리 (`contract_manage.php`):**
    - 고객 등록 폼 및 계약 상세 입력 폼 구현.
    - 계약 리스트 조회 (페이징`pagination.php` 적용).
2.  **수납 관리 (`collection_manage.php`):**
    - 계약 선택 -> 입금액 입력 -> `process_collection` 호출 -> 결과 확인.
    - 영수증 출력 기능 (자바스크립트 `window.print()` 활용, 별도 CSS 적용).
3.  **원장 조회 (`transaction_ledger.php`, `bond_ledger.php`):**
    - `collections` 테이블을 기반으로 거래 내역을 테이블 형태로 출력.
    - 필터링(날짜, 고객명) 기능 추가.

---

## 5. 시스템 통합 및 고도화 (Integration & Refinement)

### 5.1 SMS 및 알림 연동
- **Wideshot API:** `common.php`에 `sendSmsApi` 함수 구현. `curl`을 사용하여 API 통신.
- **예약 발송:** `sms.php`에서 날짜 선택 시 해당 일자, 해당 금액(예상 이자 계산 결과)을 템플릿 문구(`[변수]`)에 치환하여 발송.

### 5.2 보안 점검 (Security Check)
- **SQL Injection 방지:** 모든 쿼리는 반드시 **PreparedStatement** (`mysqli_prepare`, `bind_param`)를 사용해야 합니다.
- **XSS 방지:** 사용자 입력값을 출력할 때는 `htmlspecialchars()` 처리.
- **파일 업로드:** 확장자 검사 (`.php`, `.exe` 등 차단) 및 파일명 난수화 저장.

### 5.3 테스트 및 검증
1.  **단위 테스트:** 이자 계산 함수에 다양한 날짜(윤년 포함)와 금리를 넣어 엑셀 계산값과 일치하는지 확인.
2.  **통합 테스트:** 신규 계약 -> 3개월 정상 입금 -> 연체 발생 -> 일부 입금 -> 완납 시나리오를 수행하며 DB 상태(`outstanding_principal`, `shortfall_amount`)가 정확한지 검증.

---

## 6. 유지보수 및 운영 (Maintenance)

- **백업:** `mysqldump`를 이용해 매일 새벽 DB 백업을 수행하도록 스케줄러(Cron) 등록 권장.
- **로그 모니터링:** `php_errors.log` 및 `sms_log` 테이블을 주기적으로 확인하여 실패 내역 점검.

이 문서를 로드맵 삼아, 기획서의 요구사항을 기술설명서의 스펙대로 하나씩 구현해 나가시기 바랍니다.
