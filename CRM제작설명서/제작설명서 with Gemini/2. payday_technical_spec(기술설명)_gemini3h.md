# Payday 프로젝트 기술설명서

## 1. 기술 스택 (Tech Stack)
- **OS:** Windows / Linux (Cross-platform PHP support)
- **Web Server:** Apache / Nginx
- **Language:** PHP 7.4+ (Pure PHP, No Framework)
- **Database:** MySQL 5.7+ / MariaDB
- **Frontend:** HTML5, CSS3, JavaScript (Vanilla + jQuery)
- **APIs:** 
    - Wideshot SMS API
    - Slack Webhook Integration

## 2. 디렉토리 구조 (Directory Structure)
```
payday/
├── css/                # 스타일시트 (style.css)
├── js/                 # 자바스크립트 파일 (main.js 등)
├── pages/              # 주요 화면 UI PHP 파일
│   ├── contract_manage.php # 계약 관리
│   ├── collection_manage.php # 수납 관리
│   ├── manual.php          # 사용자 매뉴얼
│   ├── transactions_ledger.php # 거래 원장
│   └── ...
├── process/            # 백엔드 처리 로직 (POST 요청 처리)
│   ├── login_process.php
│   ├── collection_process.php
│   └── ...
├── includes/           # (Optional) 공통 인클루드 파일
├── uploads/            # 파일 업로드 디렉토리 (계약서, 이미지 등)
├── common.php          # 공통 함수 및 DB 연결 초기화
├── config.php          # DB 설정 파일
├── login.php           # 로그인 페이지
└── index.php           # 메인 진입점
```

## 3. 데이터베이스 설계 (Database Schema)

### 주요 테이블
1. **contracts (계약):** 대출 계약의 핵심 정보 (대출금, 이자율, 만기일 등)
2. **customers (고객):** 차주 정보 (이름, 연락처, 주민번호 등)
3. **collections (수납):** 입금 및 수납 내역 (원금, 이자, 경비 분개)
4. **condition_changes (조건 변경):** 금리 변경 등 계약 변경 이력 (SCD Type 2 유사)
5. **contract_expenses (비용):** 계약 관련 비용 발생 내역
6. **holidays (휴일):** 이자 계산 시 영업일 처리를 위한 휴일 정보
7. **company_info (회사 정보):** 시스템 전반에 표시될 회사 설정

## 4. 설치 및 세팅 가이드 (Installation)

### 4.1 필수 요구사항
- PHP가 설치된 웹 서버 (XAMPP, WAMP, Docker 등)
- MySQL 데이터베이스 서버

### 4.2 설치 단계
1. **소스 코드 배포:** 프로젝트 폴더를 웹 서버의 루트(`htdocs` 또는 `www`)에 위치시킵니다.
2. **데이터베이스 생성:** MySQL에서 `payday` 데이터베이스를 생성합니다.
3. **SQL 임포트:** 제공된 `payday_db_YYYYMMDD.sql` 파일을 실행하여 테이블 구조와 초기 데이터를 생성합니다.
4. **설정 파일 수정:** `config.php` 파일을 열어 DB 접속 정보를 수정합니다.
   ```php
   define('DB_SERVER', 'localhost');
   define('DB_USERNAME', 'your_db_user');
   define('DB_PASSWORD', 'your_db_password');
   define('DB_NAME', 'payday');
   ```
5. **권한 설정:** `uploads/` 디렉토리에 쓰기 권한을 부여합니다.

## 5. 핵심 로직 설명 (Core Logic)

### 5.1 이자 계산 (Interest Calculation)
- **일수 계산:** `common.php`의 `calculateAccruedInterestForPeriod` 함수를 사용합니다.
- **윤년 처리:** 윤년(366일)과 평년(365일)을 구분하여 일할 계산합니다.
- **변동 금리:** `condition_changes` 테이블을 참조하여 기간별로 적용된 이자율/연체이자율을 각각 구간별로 계산하여 합산합니다.

### 5.2 수납 처리 (Payment Processing)
- **트랜잭션:** 수납 처리는 원자성을 보장하기 위해 DB 트랜잭션(`mysqli_begin_transaction`) 내에서 수행됩니다.
- **우선순위:** 수납액은 경비 -> 이자 -> 원금 순서로 차감됩니다 (일반적인 회계 원칙).
- **부족금(Shortfall):** 당일 발생한 이자보다 수납액이 적을 경우, 차액은 `shortfall_amount`에 누적되어 다음 수납 시 우선 변제됩니다.

### 5.3 SMS 발송
- Wideshot API를 사용하여 비동기(또는 동기) 방식으로 문자를 발송합니다.
- 발송 이력은 데이터베이스에 저장되며, 발송 결과는 API 콜백 또는 조회 함수를 통해 업데이트됩니다.

## 6. 유용한 팁
- **디버깅:** `php_errors.log` 파일을 주기적으로 확인하여 PHP 에러를 모니터링하세요.
- **백업:** `dump.php` 또는 수동 백업을 통해 정기적으로 DB 덤프를 생성하세요.
- **커스터마이징:** `css/style.css`에서 테마 색상을 변경하여 회사 브랜딩에 맞출 수 있습니다.
